# HTTP入门到放弃

## 1.网络基础
TCP/IP协议族按层次：
- 应用层 http协议 DNS..
- 传输层 TCP传输控制协议 UDP用户数据报协议...
- 网络层 IP协议...
- 链路层

        
>  chrome一次性只能处理6个tcp请求。其他的请求必须等待6个请求完成，这个等待时间是构成stalling的主要部分



**与http协议关系密切的协议: IP,TCP,DNS**

    - 负责传输的IP协议： 把各种数据包传递给对方，两个最重要的条件是IP地址和MAC地址      ARP解析地址的协议
    - 确保可靠性的TCP协议： 采用三次握手的策略 利用两个TCP标志，SYN（synchronize）和ACK（acknowledgement）
    - 负责域名解析的DNS服务： 提供域名到IP地址之间的解析服务
    
TCP
```
sequenceDiagram
发送端->>接收端: 标有SYN的数据包发送给你了
接收端->>发送端:收到！并发送标有SYN/ACK的数据包
发送端->接收端: 明白！发送标有ACK的数据包

```

    
>  三者在http协议通讯过程中发挥的作用

    发送端从上往下走，接收端从下往上走
    
    客户端：访问www.baidu.com/xss/web.html 
    经过DNS协议：返回对应的IP地址
    HTTP协议的职责：生成对应的http请求报文 （请给我www.baidu.com/xss/web.html 页面的资源）
    TCP协议的职责：将HTTP请求报文分割成报文段把每个报文段（打上标记序号和端口号）可靠地传给对方
    IP协议：搜索对方的地址，一遍中转一遍传送
    
    --发送端在层与层之间传递数据时，每经过一层就会打上该层的首部信息，
    --反之，接受端在层与层之间传递数据时，每经过一层就会把对应的首部消去
    
    服务器端：
    TCP协议的职责：从对方那里接受报文段，按序号以原来的顺序重组
    HTTP协议的职责：对Web服务器请求内容的处理 (原来是想要这台计算机上xss/资源呀)
    请求的结果也同样利用TCP/IP通讯协议向用户回传


## 2.简单的HTTP协议



- HTTP协议用于客户端和服务端之间的通讯
- 通过请求和响应的交换达成通讯
    - 请求报文是由请求方法，请求URI，协议版本号，可选的请求头部字段和内容实体构成
    - 响应报文是由协议版本，状态码，用以解释状态码的原因短语，可选的响应首部字段，以及实体
- HTTP不保存状态的协议 无状态（stateless）协议
- 告知服务器意图的HTTP请求
    1. GET 获取资源
    
            GET方法用来请求访问已被URI识别的资源。指定的资源京服务器解析后返回响应的内容
    2. POST 传输实体主体
            post主要目的并不是获取响应的主体内容，而是 ‘我要把信息告诉你’

    3. PUT 传输文件
    
    4. HEAD 获取报文首部
    
    5. DELETE 删除文件
    
    6. OPTIONS 询问支持的方法  ‘你支持什么方法？’ 
    
    7. TRACE 追踪路径
    
    8. CONNECT 要求用隧道协议连接代理
    

### 持久连接 Connection:keep-alive
        
        持久连接的特点：只要任意一端没有明确提出断开连接，就保持TCP连接状态，减少了TCP连接建立和断开造成的额外开销，减轻服务器负担
        
### 管道化 
        
        同时并行发送多个请求  
        

### cookie技术
    Cookie技术通过在请求和响应报文中加入Cookie信息来控制服务端状态
    
    Cookie会根据从服务器端发送的响应报文中的Set-Cookie的首部字段信息，通知客服端保存Cookie，当下次服务端再往该服务器发送请求时会自动在请求报文中加入cookie字段
    服务器端发现客户端发送过来的cookie回去检查是哪个客户端发来的请求，然后对比服务器上的记录，最后得到之前的状态
    
    
    第一次没有cookie信息下的请求：
        
        客户端发送请求，服务端生成Cookie记住是谁发送的，然后偶在响应首部信息中加Set-Cookie返回，客户端保存Cookie
        
    第二次之后（存有cookie）的请求
    
        客户端请求 在首部信息中自动添加cookie 服务端检查cookie，再响应
        

## 3.http报文中的http信息

> 本章了解请求和响应是如何运作的

    用于HTTP协议交互的信息被成为HTTP报文，分为报文首部，报文主体
    
    
- 请求报文
    1. 报文首部
        - 请求行  (请求的方法，请求URI HTTP版本)
        - 请求首部字段
        - 通用首部字段
        - 实体首部字段
    2. 空行（CR+LF）
    3. 报文主体
- 响应报文
    1. 报文首部
        - 状态行  （状态码，原因短语  HTTP版本）
        - 响应首部字段
        - 通用首部字段
        - 实体首部字段
    2. 空行（CR+LF）
    3. 报文主体
>  首部字段中包含请求响应的各种条件和属性的各类首部

### 编码提成传输速率

- 压缩传输的内容编码，分类：
    - gzip （GUN zip）
    - compress （UNIX系统的标准压缩）
    - deflate （zlib）
    - identity （不压缩）
- 分块发送的分块传输编码 --把实体主体分块


### 发送多种数据的多部分对象集合
> 通常在文件上传是使用
- multipart/form-data 文件上传时使用
-  multipart/buteranges 响应206（部分内容）包含了多个范围的内容时使用
- content-Type: multipart/form-data ;**boundary**=xxxx    使用boundary花纹多部分对象集合指明的各类实体


### 获取部分内容的范围请求
- 从5001到10000字节Range: bytes=5001-10000，xxxx-xxxx
- 从5001到最后字节Range: bytes=5001-
- 针对范围请求，会响应206 另外对于多重范围的范围请求,会在响应首部加上mutipart/buyeranges
- 若服务器无法响应范围请求，则返回200以及完整实体内容


### 内容协商返回最合适的内容

> 内容协商机制是指客户端和服务端就响应的资源内容进行交涉，然后提供给客户端最合适的资源。
> 一般包括 语言，字符集，编码方式为基准判断响应的资源
-  Accept
-  Accept-Charset
-  Accept- Encoding
-  Accept-Language
-  Content-Language

内容协商技术分为三类：

    - 服务器驱动协商
    - 客户端驱动协商
    - 透明协商

## 4.常见HTTP状态码

> 本章介绍HTTP状态码

    状态码的职责是当客户端向服务端发送请求时，描述返回的请求。
    

header 1 | 类别 | 原因短语
---|---|---
1XX | Informational(信息性状态码) | 接受的请求正在处理
2XX | Success(成功状态码) | 请求正确处理完毕
3XX | Redirection(重定向) | 需要进行附加操作以完成请求
4XX | Client Error(客户端错误状态码) | 服务器无法处理请求
5XX | Server Error(服务端错误状态码) | 服务端处理请求出错


### 2xx 成功
> 2xx的响应结果表明请求被正确处理了

- **200 OK**  
    客户端发来的请求被正确处理了
- **204 No Content**    
    请求被正确处理了，但是没有资源可返回。*(一般只需要从客户端往服务器发送信息，二队客户端不需要发送新信息内容的情况下使用。)*
-   206 Partial Content (对资源某一部分的请求)        
    表明客户端进行了范围请求，而服务器成功执行了这部分的GET请求，请求不成功则会返回200请求全部

### 3xx 重定向
> 3xx响应结果表明服务器需要执行某些特殊的处理以正确处理请求
- **301 Moved Permanently** (资源的URI已更新，你也更新下你的书签引用吧)       
    永久性重定向。 请求的资源已被分配了新的URL，以后应使用现在的URI。如果保存了书签，这时应该按Location首部字段提示的URI保存。
- **302 Found** (资源的URI已临时定位到其他位置，姑且算你已经知道这个情况了)    
    临时性重定向。  请求的资源已被分配了新的URL，希望用户(本次)能使用新的URI访问 不会更新书签
- **303 See Other**  (资源的URI已更新，你是否能临时按新的URI访问呢)    
    请求对象的资源存在着另外一个URI，应使用GET请求定向获取请求的资源
- **304 Not Modified** (资源已找到，但是未符合条件请求 )   
    表示客户端发送附带条件的请求时，服务器端允许请求访问资源，但因为请求为未满足条件的情况后，直接返回304
    
        (服务器端资源未改变，可直接使用客户端未过期的缓存)
        (并且不返回任何的响应主体部分，虽然304划分在3xx类别中，但是和重定向没有半毛钱关系)
        附带条件的请求指的是：GET方法的请求报文中包含 If-Match If-None-Match If-Range If-Unmodified-since中的任一首部字段
- **307 Temporary Redirect**     
    临时重定向。与302有相同的含义，尽管302禁止POST变换为GET，但实际上大家并不遵守。307遵照浏览器标准不会将POST改为GET，但浏览器处理各不相同
    
### 4xx客户端错误
> 4xx的响应结果表明客户端是发生错误的原因所在。
- **400 Bad Request** (我无法理解这个请求，是不是错了？)   
    请求报文中存在语法错误。浏览器会想200 ok一样对待改状态码
- **401 Unauthorized**    (本页面需要认证)   
    发送的请求你需要有通过HTTP认证(BASIC认证，DIGEST认证)的认证信息。若之前请求过一次，则用户认证失败。
    返回401的响应必须包含一个适用于被请求资源的WWW-Authenticate首部用以质询(challenge)用户信息。当浏览器初次接收到401时，会弹出认证用的对话框。
- **403 Forbidden** (不允许访问那个资源哇)
    对请求资源的访问被服务器拒绝了。
        
        未获得文件系统的访问授权，访问权限出现某些问题时(从未授权的发送源IP地址试图访问)出现
- **404 Not Found** (求的资源服务器没有请)   
    服务器上无法找到请求的资源，或者服务器端拒绝请求并且不想说明理由时用~

### 5xx服务器错误
> 5xx的响应结果表明服务器本身发生错误

- **500 Internal Server Error** (内部资源出现故障)  
    服务器端在执行球球的时候发生错误。当然也可能是Web应用存在的bug或后写临时的故障导致。

- **503 Service Unavailable**    
    服务器暂时处在超负荷或者正在停机维护，现在无法处理请求。
        
        如果事先得知解除以上状况需要的时间，最好写入 Retry-After首部字段给客户端。

> 此外，状态码和状态可能不一致，比如Web应用程序内部发生错误，状态码依然返回200 ok。
    


